name: CI Linux

on:
  workflow_dispatch:
  push:
    paths-ignore:
      - '**.md'
      - '**.yml'
      - '!**/linux_ci.yml'
      - 'cmd/tools/**'
      - '!cmd/tools/builders/**.v'
  pull_request:
    paths-ignore:
      - '**.md'
      - '**.yml'
      - '!**/linux_ci.yml'
      - 'cmd/tools/**'
      - '!cmd/tools/builders/**.v'

jobs:
  check-error-integration:
    runs-on: ubuntu-latest
    timeout-minutes: 121
    env:
      VFLAGS: -cc tcc -no-retry-compilation
    steps:
      - uses: actions/checkout@v4
      - name: Show custom error
        run: echo '::error file=vlib/flag/flag_test.v,line=98::this is a custom error message'
      - name: Show custom warning
        run: echo '::warning file=vlib/flag/flag_test.v,line=7::this is a custom warning message'
      - name: Show custom notice
        run: echo '::notice file=vlib/flag/flag_test.v,line=60::this is a custom warning message'
      - name: Build v
        run: make && ./v symlink
      - name: Check compilation failure
        run: echo 'invalid code' > invalid_code.v && v run invalid_code.v
